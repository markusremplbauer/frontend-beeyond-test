<mat-card-title>Create a new Blueprint</mat-card-title>
<mat-card-subtitle>Write your blueprint here:</mat-card-subtitle>
<mat-horizontal-stepper
  [linear]="true"
  (selectionChange)="stepperSelectionChange($event)"
  color="primary"
>
  <mat-step
    [completed]="!((blueprintType === 'Template' && templateId === null) || blueprintType === '')"
  >
    <ng-template matStepLabel><span *ngIf="!mobileQuery.matches">Select Type</span></ng-template>

    <div class="stepper-content">
      <div class="type-wrapper">
        <div
          class="border"
          style="flex: 1; padding-top: 3%; padding-bottom: 3%;"
          mat-flat-button
          [ngClass]="blueprintType === 'Custom' ? 'selected' : ''"
          (click)="updateBlueprintType('Custom')"
        >
          <p style="margin: 5px">Custom</p>
          <p class="subtext">
            Describe your own Kubernetes object by submitting a YAML specification
          </p>
          <mat-icon style="margin: 5px">create</mat-icon>
        </div>
        <div
          class="border"
          style="flex: 1; padding-top: 3%; padding-bottom: 3%;"
          mat-flat-button
          [ngClass]="blueprintType === 'Template' ? 'selected' : ''"
          (click)="updateBlueprintType('Template')"
        >
          <p style="margin: 5px">Template</p>
          <p class="subtext">Choose a predefined template with wildcards for you to fill in</p>
          <mat-icon style="margin: 5px">file_copy</mat-icon>
        </div>
      </div>

      <app-template-list
        style="margin-top: 10px; overflow: auto;"
        *ngIf="blueprintType === 'Template'"
        [templates]="templates"
        (templateIdEvent)="setTemplateId($event)"
      >
      </app-template-list>
    </div>

    <div class="button-container">
      <button
        mat-flat-button
        color="primary"
        matStepperNext
        [disabled]="(blueprintType === 'Template' && templateId === null) || blueprintType === ''"
        (click)="loadTemplate()"
      >
        Next
      </button>
    </div>

  </mat-step>

  <mat-step
    [completed]="
      !(
        (blueprintType === 'Custom' && secondFormGroup.invalid) ||
        (blueprintType === 'Template' && templateForm && templateForm.invalid)
      )
    "
  >
    <ng-template matStepLabel><span *ngIf="!mobileQuery.matches">Set Content</span></ng-template>

    <div [formGroup]="secondFormGroup" style="height: 100%" *ngIf="blueprintType === 'Custom'">
      <ngx-monaco-editor
        [options]="monacoOptions"
        class="monaco-editor monaco-editor-border"
        formControlName="content"
        style="height: 100%"
      >Â´
      </ngx-monaco-editor>
    </div>

    <ng-container *ngIf="blueprintType === 'Template' && template" style="height: 100%">
      <mat-card-title>{{ template.name }}</mat-card-title>
      <mat-card-subtitle>{{ template.description }}</mat-card-subtitle>

      <form
        [formGroup]="templateForm"
        style="height: 100%; display: flex; flex-direction: column; justify-content: space-between"
      >
        <div>
          <div
            *ngFor="let field of template.fields; let i = index"
            class="field-container"
            formArrayName="fieldValues"
            style="display: flex; flex-direction: row"
          >
            <ng-container [formGroupName]="i">
              <mat-form-field style="width: 100%" class="full-width wildcard">
                <mat-label>{{ field.label }}</mat-label>
                <input matInput formControlName="value"/>
                <mat-error *ngIf="templateForm.get('fieldValues').invalid"></mat-error>
              </mat-form-field>
              <mat-icon
                matTooltip="{{
                  field.description ? field.description : 'No description available!'
                }}"
                matTooltipPosition="left"
              >help_outline
              </mat-icon>
            </ng-container>
          </div>
        </div>
<!--        <button style="width: 100%" mat-stroked-button (click)="openDialog()" color="primary">-->
<!--          Evaluate and Show-->
<!--        </button>-->
      </form>
    </ng-container>

    <div class="button-container">
      <button mat-flat-button color="primary" matStepperPrevious>Previous</button>
      <button
        mat-flat-button
        color="primary"
        matStepperNext
        (click)="loadServices()"
        [disabled]="
          (blueprintType === 'Custom' && secondFormGroup.invalid) ||
          (blueprintType === 'Template' && templateForm && templateForm.invalid)
        "
      >
        Next
      </button>
    </div>
  </mat-step>

  <mat-step *ngIf="services.length !== 0">
    <ng-template matStepLabel
    ><span *ngIf="!mobileQuery.matches">Choose services</span></ng-template
    >
    <mat-card-title>Ingress creation</mat-card-title>
    <mat-card-subtitle>Select the services you want an ingress for</mat-card-subtitle>
    <div style="height: 100%">
      <div *ngFor="let service of services" style="display: flex; align-items: center">
        <mat-checkbox
          [(ngModel)]="service.selected"
          style="margin: 10px"
          color="primary"
        ></mat-checkbox>
        {{ service.name }}
      </div>
    </div>
    <div class="button-container">
      <button mat-flat-button color="primary" matStepperPrevious>Previous</button>
      <button mat-flat-button color="primary" matStepperNext [disabled]="">Next</button>
    </div>
  </mat-step>

  <mat-step [stepControl]="thirdFormGroup">
    <ng-template matStepLabel>
      <span *ngIf="!mobileQuery.matches">Fill out information</span>
    </ng-template>

    <app-application-preview *ngIf="(blueprintType === 'Custom' && secondFormGroup.valid) ||
        (blueprintType === 'Template' && templateForm && templateForm.valid)"
                             style="height: 100%" [data]="getPreviewData()"></app-application-preview>

    <div class="button-container">
      <button mat-flat-button color="primary" matStepperPrevious>Previous</button>
      <button
        mat-raised-button
        color="primary"
        (click)="copyToClipboard()"
        [cdkCopyToClipboard]="getContent()"
        *ngIf="(blueprintType === 'Custom' && secondFormGroup.valid) ||
        (blueprintType === 'Template' && templateForm && templateForm.valid)"
      >
        <mat-icon>file_copy</mat-icon>
      </button>
      <button
        mat-raised-button
        color="primary"
        (click)="downloadFile()"
        *ngIf="(blueprintType === 'Custom' && secondFormGroup.valid) ||
        (blueprintType === 'Template' && templateForm && templateForm.valid)"
      >
        <mat-icon>cloud_download</mat-icon>
      </button>
      <button
        mat-flat-button
        color="primary"
        [disabled]="thirdFormGroup.invalid"
        (click)="createBlueprint()"
      >
        Create
      </button>
    </div>
  </mat-step>
</mat-horizontal-stepper>

